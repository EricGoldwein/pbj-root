# Q3 2025 Data Update Checklist

This document outlines all files, scripts, and pages that need to be updated when adding Q3 2025 data, new provider info, and updated SFF data.

## Overview

**Current State:** Q2 2025 (2025Q2) is the latest quarter  
**Target State:** Q3 2025 (2025Q3) will become the latest quarter  
**Comparison Quarter:** Q2 2025 will become the comparison quarter (replacing Q1 2025)

---

## 1. Data Files (CSV/JSON)

### Primary Data Files (Root Directory)
- [ ] `national_quarterly_metrics.csv` - Add Q3 2025 row
- [ ] `state_quarterly_metrics.csv` - Add Q3 2025 rows for all states
- [ ] `cms_region_quarterly_metrics.csv` - Add Q3 2025 rows for all regions
- [ ] `facility_lite_metrics.csv` - Add Q3 2025 facility data
- [ ] `provider_info_combined.csv` - Add Q3 2025 provider info data
- [ ] `provider_info_combined_latest.csv` - Extract Q3 2025 only (run `extract_latest_quarter.py`)
- [ ] `facility_335513_complete_data.csv` - **Add Q3 2025 daily data (July 1 - September 30, 2025)**
  - Currently ends at 2025-06-30 (end of Q2 2025) - **3,013 rows total**
  - This is the Seagate facility daily data file used by `pbj-sample.html` (line 1559)
  - Contains daily-level staffing data (one row per day)
  - **REQUIRES:** Daily-level PBJ source data from CMS for Q3 2025
  - **ACTION:** Extract Q3 2025 daily data for facility 335513 from CMS PBJ daily files and append
  - Q3 2025 = ~92 days (July 1 - September 30, 2025)
  - **Script available:** `extract_seagate_q3_data.py` - Run with source daily data file
- [ ] `facility_335513_provider_info_data.csv` - **Add Q3 2025 provider info entries**
  - Currently has data up to 2025-07-01 but quarter field shows "2025Q1" (may need correction)
  - Contains monthly provider info data for Seagate facility
  - **REQUIRES:** Q3 2025 data must exist in `provider_info_combined.csv` first
  - **ACTION:** Once Q3 2025 is in `provider_info_combined.csv`, run `update_seagate_q3_data.py` to extract
  - Need to add entries for Q3 2025 months (July, August, September 2025) with quarter="2025Q3"

### SFF Data Files
- [ ] `pbj-wrapped/public/sff_table_a.csv` - Current SFFs (Table A)
- [ ] `pbj-wrapped/public/sff_table_b.csv` - SFF Graduates (Table B)
- [ ] `pbj-wrapped/public/sff_table_c.csv` - Terminated SFFs (Table C)
- [ ] `pbj-wrapped/public/sff_table_d.csv` - SFF Candidates (Table D)
- [ ] `pbj-wrapped/public/sff-facilities.json` - Combined SFF JSON (run `pbj-wrapped/scripts/convert-sff-csvs-to-json.py`)

### Generated JSON Files (pbj-wrapped/public/data/json/)
These are generated by `preprocess-data.js` - will need to regenerate:
- [ ] `national_q1.json` - Update to Q2 2025
- [ ] `national_q2.json` - Update to Q3 2025
- [ ] `state_q1.json` - Update to Q2 2025
- [ ] `state_q2.json` - Update to Q3 2025
- [ ] `region_q1.json` - Update to Q2 2025
- [ ] `region_q2.json` - Update to Q3 2025
- [ ] `facility_q1.json` - Update to Q2 2025
- [ ] `facility_q2.json` - Update to Q3 2025
- [ ] `provider_q1.json` - Update to Q2 2025
- [ ] `provider_q2.json` - Update to Q3 2025
- [ ] State-specific JSON files (e.g., `provider_AL_q1.json`, `provider_AL_q2.json`)
- [ ] Region-specific JSON files (e.g., `provider_region1_q1.json`, `provider_region1_q2.json`)

### Other Data Files
- [ ] `national_historical_data.json` - Add Q3 2025 entry, update `latest_quarter` to "2025Q3"
- [ ] `state_historical_data.json` - Add Q3 2025 entries
- [ ] `quarters_list.json` - Add "Q3 2025" entry
- [ ] `latest_quarter_data.json` - Update to Q3 2025 (generated by `generate_dynamic_data_json.py`)
- [ ] `playground_distributions.json` - Update quarter to "2025Q3"
- [ ] `quarterly_medians.json` - Add Q3 2025 entry (currently ends with 2025Q1, missing Q2 2025 and Q3 2025)
  - Contains quarterly median HPRD values by quarter
  - Format: `{"CY_Qtr": "2025Q3", "Total_Nurse_HPRD_Median": X.XXX, ...}`

---

## 2. Configuration & Script Files

### Date Utilities
- [ ] `utils/date_utils.py`
  - Update `provider_info_latest` from 'September 2025' to 'December 2025' (or appropriate month)
  - Update `provider_info_previous` from 'June 2025' to 'September 2025'
  - Update `affiliated_entity_latest` if needed

### Preprocessing Scripts
- [ ] `pbj-wrapped/scripts/preprocess-data.js`
  - Update `TARGET_QUARTERS` constant: Change `['2025Q1', '2025Q2']` to `['2025Q2', '2025Q3']`
  - This script generates all the JSON files in `pbj-wrapped/public/data/json/`

- [ ] `extract_latest_quarter.py`
  - No changes needed - automatically extracts latest quarter from CSV files

- [ ] `pbj-wrapped/scripts/convert-sff-csvs-to-json.py`
  - Run this after updating SFF CSV files to regenerate `sff-facilities.json`

### Analysis Scripts
- [ ] `analyze_sff_hprd.py`
  - Update references from Q2 2025 to Q3 2025 (lines 46, 63, 86)
  - Update file paths if needed

---

## 3. TypeScript/React Components (pbj-wrapped/src/)

### Data Loader
- [ ] `pbj-wrapped/src/lib/wrapped/dataLoader.ts`
  - Lines 616-617: Update quarter filters from `['2025Q1']` and `['2025Q2']` to `['2025Q2']` and `['2025Q3']`
  - Lines 610, 612-613: Update quarter filters for national, state, region, facility data
  - Lines 351-361: JSON file paths remain the same (q1/q2 naming), but data content changes

### Page Components
- [ ] `pbj-wrapped/src/pages/wrapped.tsx`
  - Line 40: Update comment from "Q2 2025" to "Q3 2025"

- [ ] `pbj-wrapped/src/pages/sff-wrapped.tsx`
  - Line 29: Update comment from "Q2 2025" to "Q3 2025"
  - Line 54: Update comment from "Q2 2025" to "Q3 2025"
  - Line 180: Update title from "Q2 2025" to "Q3 2025"

- [ ] `pbj-wrapped/src/pages/sff-page.tsx`
  - Lines 131, 135, 139, 143: Update SEO descriptions from "Q2 2025" to "Q3 2025"
  - Line 149: Update keywords from "Q2 2025" to "Q3 2025"
  - Line 216: Update comment from "Q2 2025" to "Q3 2025"
  - Line 319: Update comment from "Q2 2025" to "Q3 2025"
  - Lines 1191, 1515, 1551: Update data source references from "Q2 2025" to "Q3 2025"

### Card Components
- [ ] `pbj-wrapped/src/components/wrapped/cards/BasicsCard.tsx`
  - Lines 159, 317-318: Update "Q2 2025" to "Q3 2025"

- [ ] `pbj-wrapped/src/components/wrapped/cards/NavigationCard.tsx`
  - Line 167: Update SFF date reference (currently "12/25") to new date

- [ ] `pbj-wrapped/src/components/wrapped/cards/NavigationCardNews.tsx`
  - Line 54: Update "Q2 2025" to "Q3 2025"

- [ ] `pbj-wrapped/src/components/wrapped/cards/TrendsCard.tsx`
  - Line 53: Update "Q1 2025 to Q2 2025" to "Q2 2025 to Q3 2025"

- [ ] `pbj-wrapped/src/components/wrapped/cards/USAOwnershipStaffingCard.tsx`
  - Line 78: Update "Q2 2025" to "Q3 2025"

- [ ] `pbj-wrapped/src/components/wrapped/cards/USAStatesExtremesCardNews.tsx`
  - Line 111: Update "Q2 2025" to "Q3 2025"

- [ ] `pbj-wrapped/src/components/wrapped/cards/USANationalScaleCard.tsx`
  - Line 68: Update "Q2 2025" to "Q3 2025"
  - Line 109: Update "Q2 2025" to "Q3 2025"

- [ ] `pbj-wrapped/src/components/wrapped/cards/USANationalScaleCardNews.tsx`
  - Line 26: Update days in quarter comment (Q3 has 92 days)

- [ ] `pbj-wrapped/src/components/wrapped/cards/KeyTakeawaysCard.tsx`
  - Line 112: Update "Q1 to Q2 2025" to "Q2 to Q3 2025"
  - Line 154: Update "Q2 2025" to "Q3 2025"

- [ ] `pbj-wrapped/src/components/wrapped/cards/KeyTakeawaysCardNews.tsx`
  - Line 93: Update "Q2 2025" to "Q3 2025"

- [ ] `pbj-wrapped/src/components/wrapped/cards/StateOverviewCard.tsx`
  - Line 57: Update "Q2 2025" to "Q3 2025"

- [ ] `pbj-wrapped/src/components/wrapped/cards/HeaderCardNews.tsx`
  - Line 32: Update "Q2 2025" to "Q3 2025"

- [ ] `pbj-wrapped/src/components/wrapped/cards/WhatIsPBJCard.tsx`
  - Line 111: Update "Q2 2025" to "Q3 2025"

---

## 4. HTML Files (Root Directory)

### Main Site Pages
- [ ] `index.html` - **NO CODE CHANGES NEEDED** - Homepage dynamically loads quarter from `latest_quarter_data.json` (line 1080). Will automatically show Q3 2025 after running `generate_dynamic_data_json.py`
- [ ] `index-render.html` - Update data range if needed (handled by `update_dynamic_dates.py`)
- [ ] `about.html` - Update quarter count and provider info dates (handled by `update_dynamic_dates.py`)
- [ ] `report.html`
  - Line 5: Update title from "Q2 2025" to "Q3 2025"
  - Line 7: Update meta description from "Q2 2025" to "Q3 2025"
  - Lines 24, 30: Update og:title and twitter:title
  - Line 121: Update default fallback from `'2025Q2'` to `'2025Q3'`
  - Line 4263: Update h1 from "Q2 2025" to "Q3 2025"
  - Line 4309: Update h2 from "Q2 2025" to "Q3 2025"
  - Line 4667: Update default fallback from `'2025Q2'` to `'2025Q3'`
  - Lines 5110, 5112, 5118, 5333: Update default quarter fallback from "Q2 2025" to "Q3 2025"

- [ ] `pbj-sample.html` (Seagate Facility Page)
  - Line 1190: Add new option `<option value="2025Q3">Q3 2025</option>` after Q2 2025 option
  - This is the Seagate Rehabilitation and Nursing Center (facility 335513) sample page

- [ ] `insights.html`
  - Line 2333: Update quarters array - add `"2025Q3"` to the end of the array
  - Currently ends with: `"2025Q1", "2025Q2"` - should end with: `"2025Q1", "2025Q2", "2025Q3"`

### Template Files
- [ ] `templates/wrapped_index.html`
  - Lines 108, 113, 120, 130: Update SEO descriptions from "Q2 2025" to "Q3 2025"

### pbj-wrapped HTML
- [ ] `pbj-wrapped/index.html`
  - Lines 9-10: Update title and description from "Q2 2025" to "Q3 2025"
  - Lines 18-19: Update og:title and og:description
  - Line 25: Update og:image:alt
  - Lines 31-32: Update twitter:title and twitter:description
  - Lines 96, 101, 108, 118: Update meta descriptions from "Q2 2025" to "Q3 2025"

---

## 5. Python Backend (app.py)

- [ ] `app.py`
  - Lines 95-96: Update provider info dates in fallback dict
  - Check `load_provider_info()` function - should automatically use latest data
  - Check `load_sff_facilities()` function - should load from updated JSON
  - Verify quarter conversion functions handle Q3 correctly

---

## 6. SEO & Metadata Files

- [ ] `utils/seo_utils.py`
  - Lines 49-52: Update all "Q2 2025" references to "Q3 2025"
  - Lines 74, 76, 89, 91, 106, 108: Update SFF page descriptions
  - Lines 124-127: Update region page SEO
  - Lines 146-149: Update state page SEO

---

## 7. Documentation Files

- [ ] `pbj-wrapped/README.md`
  - Line 1: Update title from "Q2 2025" to "Q3 2025"
  - Line 50: Update description from "Q2 2025" to "Q3 2025"

- [ ] `pbj-wrapped/SETUP.md`
  - Line 52: Update description from "Q2 2025" to "Q3 2025"

- [ ] `pbj-wrapped/SLIDE_ORDER_AND_STYLE.md`
  - Lines 113, 388, 391, 505: Update "Q2 2025" references to "Q3 2025"

- [ ] `SFF_HPRD_ANALYSIS_SUMMARY.md`
  - Lines 4, 85-86: Update data source references from "Q2 2025" to "Q3 2025"

- [ ] `pbj-wrapped/package.json`
  - Line 4: Update description from "Q2 2025" to "Q3 2025"

---

## 8. Batch/Shell Scripts

- [ ] `pbj-wrapped/start-dev.bat`
  - Line 11: Update echo message from "Q2 2025" to "Q3 2025"
  - Line 111: Update preprocessing message

- [ ] `pbj-wrapped/start-dev-debug.bat`
  - Line 5: Update echo message from "Q2 2025" to "Q3 2025"

- [ ] `pbj-wrapped/preprocess-data.bat`
  - Verify it runs `preprocess-data.js` correctly

---

## 9. Utility Scripts

- [ ] `update_dynamic_dates.py`
  - Lines 23-24, 41-42: Update fallback provider info dates
  - This script updates HTML files automatically

- [ ] `make_dynamic.py`
  - No changes needed - reads from `date_utils.py`

- [ ] `generate_dynamic_data_json.py`
  - Line 184: Update hardcoded message from "Q2 2025 data" to "Q3 2025 data" (or make it dynamic)
  - **IMPORTANT:** This script automatically detects the latest quarter from CSV files, so it will generate Q3 2025 data once Q3 2025 is in the CSVs
  - **Must run this script** after adding Q3 2025 data to CSVs to update `latest_quarter_data.json` (which the homepage uses)

- [ ] `pbj-wrapped/check-ny-data.js`
  - Line 11: Update quarter filter from "2025Q2" to "2025Q3"
  - Line 43: Update console message

---

## 10. Update Workflow

### Step-by-Step Process:

1. **Update Data Files**
   - Add Q3 2025 data to all CSV files (national, state, region, facility, provider)
   - Update SFF CSV files (Tables A-D)
   - Run `extract_latest_quarter.py` to create `provider_info_combined_latest.csv`
   - **Run `generate_dynamic_data_json.py`** to regenerate `latest_quarter_data.json`, `national_historical_data.json`, `state_historical_data.json`, and `quarters_list.json` (this updates the homepage automatically)
   - **Update `quarterly_medians.json`** - Add Q2 2025 and Q3 2025 entries (calculate medians from facility data)
   - **Update Seagate facility files:**
     - Once Q3 2025 is in `provider_info_combined.csv`, run `update_seagate_q3_data.py` to update provider info file
     - For daily data file, extract Q3 2025 from CMS PBJ daily source files using `extract_seagate_q3_data.py`

2. **Convert SFF Data**
   - Run `pbj-wrapped/scripts/convert-sff-csvs-to-json.py` to generate `sff-facilities.json`

3. **Update Configuration**
   - Update `utils/date_utils.py` with new provider info dates
   - Update `pbj-wrapped/scripts/preprocess-data.js` TARGET_QUARTERS

4. **Regenerate JSON Files**
   - Run `pbj-wrapped/preprocess-data.bat` or `node pbj-wrapped/scripts/preprocess-data.js`
   - This generates all the optimized JSON files in `pbj-wrapped/public/data/json/`

5. **Update Code References**
   - Update all TypeScript/React components (see section 3)
   - Update HTML files (see section 4)
   - Update Python backend if needed (see section 5)

6. **Update Documentation**
   - Update README files, package.json, etc. (see section 7)

7. **Update Date Utilities**
   - Run `update_dynamic_dates.py` to update HTML files with new dates
   - Or run `make_dynamic.py` to see what needs updating

8. **Test**
   - Verify data loads correctly
   - Check that Q3 2025 appears as latest quarter
   - Verify Q2 2025 is used for comparisons
   - Test SFF data displays correctly
   - Check all pages render with correct dates

---

## 11. Key Quarter Format Conversions

The codebase uses multiple quarter formats:
- **State format:** `2025Q3` (used in CSV files, dataLoader.ts)
- **Provider format:** `Q3 2025` (used in provider_info_combined.csv)
- **Display format:** `Q3 2025` (used in UI components)

Conversion functions exist in:
- `app.py` - `convert_quarter_format()` function
- `dataLoader.ts` - `filterByQuarter()` handles both formats
- `extract_latest_quarter.py` - Converts between formats

---

## 12. Notes

- The `q1` and `q2` naming in JSON files is a convention - they represent "previous quarter" and "latest quarter", not literal Q1/Q2
- When updating to Q3 2025:
  - `q1` JSON files should contain Q2 2025 data
  - `q2` JSON files should contain Q3 2025 data
- Provider info dates are separate from quarter dates and may update on different schedules
- SFF data comes from CMS postings and may have different update dates than PBJ data
- Always test data loading after updates to ensure filters work correctly

---

## 13. Quick Reference: Files with Most References

Files with the most "Q2 2025" references that need updating:
1. `pbj-wrapped/src/pages/sff-page.tsx` - 6+ references
2. `utils/seo_utils.py` - 10+ references
3. `pbj-wrapped/index.html` - 8+ references
4. `report.html` - 20+ references (title, meta tags, headings, JavaScript defaults)
5. `insights.html` - 1 reference (quarters array)
6. `pbj-sample.html` (Seagate page) - 1 reference (dropdown option)
7. Various card components - 1-2 references each

Use `grep -r "Q2 2025"` or `grep -r "2025Q2"` to find all instances.

## 14. Special Pages Summary

### Report Page (`report.html`)
- **Status:** ✅ Covered in checklist
- **References:** 20+ instances including:
  - Page title and meta tags
  - H1 and H2 headings
  - JavaScript default fallback values
  - Quarter format conversion comments

### Insights Page (`insights.html`)
- **Status:** ✅ Now covered in checklist
- **References:** 1 instance
  - Line 2333: Hardcoded quarters array needs "2025Q3" added

### Seagate Page (`pbj-sample.html`)
- **Status:** ✅ Now covered in checklist
- **References:** 1 instance
  - Line 1190: Dropdown option needs "2025Q3" added
  - This is the facility-specific page for Seagate Rehabilitation and Nursing Center (CCN: 335513)
